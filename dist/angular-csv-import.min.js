/*! angular-csv-import - v0.0.14 - 2015-02-13
* Copyright (c) 2015 ; Licensed  */
"use strict";var csvImport=angular.module("ngCsvImport",[]);csvImport.directive("ngCsvImport",function(){return{restrict:"E",transclude:!0,replace:!0,scope:{content:"=",header:"=",headerVisible:"=",separator:"=?",separatorVisible:"=",result:"="},template:'<div><div ng-show="header && headerVisible"><div class="label">Header</div><input type="checkbox" ng-model="header"></div><div ng-show="separatorVisible" ><div class="label">Seperator</div><input type="text" ng-change="changeSeparator" ng-model="separator"></div><div><input class="btn cta gray" type="file"/></div></div>',controller:function(a){a.separator=a.separator||","},link:function(a,b){b.on("keyup",function(b){if(null!=a.content){var d={csv:a.content,header:a.header,separator:b.target.value};a.result=c(d),a.$apply()}}),b.on("change",function(b){var d=new FileReader;if(d.onload=function(b){a.$apply(function(){var d={csv:b.target.result.replace(/\r\n|\r/g,"\n"),header:a.header,separator:a.separator};a.content=d.csv,a.result=c(d)})},"file"!==b.target.type||null==b.target.files&&null==b.srcElement.files){if(null!=a.content){var e={csv:a.content,header:!a.header,separator:a.separator};a.result=c(e)}}else d.readAsText((b.srcElement||b.target).files[0])});var c=function(a){var b=a.csv.split("\n"),c=[],d=0,e=b[0].split(a.separator).length,f=[];a.header&&(f=b[0].split(a.separator),d=1);for(var g=d;g<b.length;g++){var h={},i=b[g].split(new RegExp(a.separator+'(?![^"]*"(?:(?:[^"]*"){2})*[^"]*$)'));if(i.length===e){if(a.header)for(var j=0;j<f.length;j++)h[f[j]]=i[j];else for(var k=0;k<i.length;k++)h[k]=i[k];c.push(h)}}return JSON.stringify(c)}}}});